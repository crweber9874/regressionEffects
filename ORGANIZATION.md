# Repository Organization

This document explains the organization and structure of the `regressionEffects` package repository.

## File Organization Principles

This repository follows standard R package conventions with additional organization for personal utility:

### 1. **R Package Structure**
Standard R package layout is maintained for compatibility with R's build tools:
- `DESCRIPTION` - Package metadata
- `NAMESPACE` - Function exports (auto-generated)
- `R/` - All R function definitions
- `man/` - Help documentation (auto-generated by roxygen2)
- `data/` - Package datasets (.rda files)

### 2. **Function Naming Conventions**

Functions are organized using consistent prefixes:

- **`brms*`** - Bayesian model fitting functions (e.g., `brmsLogit`, `brmsNominal`)
- **`gg*`** - Visualization functions using ggplot2 (e.g., `ggSunflower`, `ggMargin`)
- **`predict*`** - Prediction-related functions (e.g., `predictOrdered`, `predictUncertainty`)
- **`posterior*`** - Posterior analysis functions (e.g., `posteriorMeans`, `posteriorMarginal`)
- **`combined_*`** - Multi-panel plotting functions (e.g., `combined_plot`, `combined_line_plot`)

### 3. **File Naming**

Each R file should:
- Contain one main function (or closely related helper functions)
- Be named after the primary function it contains
- Use snake_case naming

Example: `generate_counterfactual_data()` function is in `counterfactual.R`

## Directory Structure

```
regressionEffects/
│
├── .vscode/                    # VSCode IDE Configuration
│   ├── settings.json          # R language server, Quarto settings
│   ├── extensions.json        # Recommended VSCode extensions
│   └── tasks.json             # Build tasks (document, check, build)
│
├── R/                         # Package Functions (30 files)
│   │
│   ├── Model Estimation (7 files)
│   │   ├── brmsLinear.R       # Bayesian linear models
│   │   ├── brmsLogit.R        # Bayesian logit models
│   │   ├── brmsNominal.R      # Bayesian nominal/multinomial models
│   │   ├── brmOrdinal.R       # Bayesian ordered models
│   │   ├── estimateBRMS.R     # General brms wrapper
│   │   ├── run_brms.R         # brms execution utilities
│   │   └── ordered_models.R   # Frequentist ordered models
│   │
│   ├── Prediction (5 files)
│   │   ├── predictOrdered.R   # Ordered model predictions
│   │   ├── predictUncertainty.R # Predictions with uncertainty
│   │   ├── preparePrediction.R  # Prediction data prep
│   │   ├── posteriorMeans.R   # Posterior predictions with interactions
│   │   └── posteriorMarginal.R # Marginal effects from posteriors
│   │
│   ├── Marginal Effects (1 file)
│   │   └── frequentistMarginal.R # Frequentist marginal effects
│   │
│   ├── Causal Inference (2 files)
│   │   ├── counterfactual.R   # G-computation counterfactual data
│   │   └── individual_treatment.R # Treatment effect estimation
│   │
│   ├── Utilities (4 files)
│   │   ├── spreadDraws.R      # Extract posterior draws
│   │   ├── summarizeDraws.R   # Summarize draws
│   │   ├── summary_posterior.R # Posterior summaries
│   │   └── zeroOne.R          # Variable rescaling
│   │
│   ├── Visualization (10 files)
│   │   ├── Basic Plots
│   │   │   ├── ggPoint.R      # Enhanced point plots
│   │   │   ├── ggMargin.R     # Marginal effect plots
│   │   │   └── ggMarginaleffect.R # Enhanced marginal plots
│   │   │
│   │   ├── Sunflower Plots (specialized)
│   │   │   ├── ggSunflower.R  # Probability + distribution plots
│   │   │   ├── ggSunflowerGrow.R # Animated sunflower
│   │   │   └── ggFlower.R     # Alternative flower visualization
│   │   │
│   │   └── Combined Plots
│   │       ├── combined_plot.R # Multi-panel plots
│   │       ├── combined_dot_plot.R # Combined dot plots
│   │       └── combined_line_plot.R # Combined line plots
│   │
│   └── Interactive (1 file)
│       └── shiny_app.R        # Shiny app launcher
│
├── data/                      # Package Datasets
│   ├── wss20.rda             # Western States Survey 2020
│   └── wss24.rda             # Western States Survey 2024
│
├── inst/                      # Additional Package Files
│   ├── brms_ordinal/         # Ordinal regression examples
│   │   ├── ordinal_regression.R
│   │   └── app.R
│   └── shiny-examples/       # Shiny application examples
│       └── ordinal_models/
│           └── app.R
│
├── vignettes/                # Long-Form Documentation
│   ├── regression_functions.qmd     # Overview of functions
│   ├── ordered_logit_preds.qmd      # Ordered logit tutorial
│   ├── predictive_and_marginal.qmd  # Predictions and effects
│   ├── apsr_analysis.qmd            # APSR analysis example
│   ├── *_files/              # Rendered output (auto-generated)
│   └── .quarto/              # Quarto cache (ignored)
│
├── figures/                  # Example Plots and Images
│   ├── burn.png
│   ├── ordered_logit_sunflower.png
│   ├── predictive_marginal_effects.png
│   └── recounts.png
│
├── man/                      # Help Documentation
│   └── *.Rd                  # Auto-generated by roxygen2
│
├── docs/                     # Package Website
│   └── *                     # Auto-generated by pkgdown
│
├── Documentation Files
│   ├── README.md             # Main package overview
│   ├── FUNCTION_REFERENCE.md # Complete function catalog
│   ├── DEVELOPMENT.md        # Development workflow guide
│   ├── ORGANIZATION.md       # This file
│   ├── DESCRIPTION           # Package metadata
│   ├── NAMESPACE             # Exports (auto-generated)
│   └── LICENSE               # MIT License
│
├── Configuration Files
│   ├── .gitignore            # Git ignore patterns
│   ├── .Rbuildignore         # R package build ignore patterns
│   ├── _pkgdown.yml          # pkgdown website config
│   ├── regressionEffects.Rproj # RStudio project file
│   └── setup_environment.R   # Automated dependency setup
│
└── Build Artifacts (gitignored)
    ├── .Rproj.user/          # RStudio project files
    ├── .Rhistory             # R command history
    └── setup_log.txt         # Setup script log
```

## Function Categories

### Model Estimation Functions

These functions fit regression models using different approaches:

- **Bayesian (brms)**: `brmsLinear`, `brmsLogit`, `brmsNominal`, `brmOrdinal`
  - Use Stan for MCMC sampling
  - Return brms model objects
  - Require cmdstan installation

- **Frequentist**: `ordered_models`
  - Use maximum likelihood estimation
  - Return polr objects (from MASS package)

### Prediction Functions

Generate predictions from fitted models:

- **Core Predictions**: `predictOrdered`, `predictUncertainty`, `preparePrediction`
- **Posterior Analysis**: `posteriorMeans`, `posteriorMarginal`
  - Work with Bayesian models
  - Return full posterior distributions

### Causal Inference Functions

Tools for causal analysis:

- **G-computation**: `generate_counterfactual_data`
  - Creates observed + counterfactual datasets
  - Flips treatment assignment
  - Used for estimating causal effects

- **Treatment Effects**: `individual_treatment`
  - Computes individual-level effects
  - Works with panel data

### Visualization Functions

#### Sunflower Plots

Unique visualization showing:
- Predicted probabilities (points + error bars)
- Distribution of observations (sunflower petals)
- Useful for ordered categorical outcomes

Files: `ggSunflower.R`, `ggSunflowerGrow.R`, `ggFlower.R`

#### Standard Plots

- Marginal effects: `ggMargin.R`, `ggMarginaleffect.R`
- Point plots: `ggPoint.R`
- Combined multi-panel: `combined_plot.R`, `combined_dot_plot.R`, `combined_line_plot.R`

### Utility Functions

Helper functions for data manipulation:

- **Posterior Draws**: `spreadDraws`, `summarizeDraws`, `summary_posterior`
  - Extract and summarize MCMC samples
  - Interface between brms and tidybayes

- **Data Transformation**: `zeroOne`
  - Rescale variables to 0-1 range
  - Useful for interpretation

## Vignettes Organization

Vignettes are Quarto documents (`.qmd`) that provide tutorials:

1. **regression_functions.qmd** - Overview of package functions
2. **ordered_logit_preds.qmd** - Tutorial on ordered logit models
3. **predictive_and_marginal.qmd** - Predictions and marginal effects workflow
4. **apsr_analysis.qmd** - Real-world analysis example

Output files (`*_files/`, `*.html`) are auto-generated by Quarto.

## Data Files

Datasets are stored as R data files (`.rda`) in `data/`:

- **wss20.rda** - Western States Survey 2020
- **wss24.rda** - Western States Survey 2024

Load with: `data(wss20)`

## Best Practices for Organization

### Adding New Functions

1. **Create new R file** in `R/` directory
2. **Name file** after the main function (snake_case)
3. **Add roxygen2 documentation** at top of function
4. **Use consistent naming**: Add appropriate prefix (gg*, brms*, predict*, etc.)
5. **Update FUNCTION_REFERENCE.md** with new function
6. **Add example** to appropriate vignette

### File Cleanup Rules

Files that should NOT be in repository root:
- ❌ Individual .png files (move to `figures/`)
- ❌ Data files .rda (move to `data/`)
- ❌ Temporary .R scripts (delete or move to `inst/`)
- ✅ Documentation .md files
- ✅ Configuration files (DESCRIPTION, NAMESPACE, etc.)
- ✅ Setup scripts (setup_environment.R)

### Gitignore Strategy

Ignored files/directories:
- Build artifacts (`.Rproj.user/`, `*.tar.gz`, `.Rcheck/`)
- Auto-generated docs (`docs/`, `man/*.Rd`)
- IDE files (`.DS_Store`)
- Quarto cache (`_cache/`, `_files/`)
- Personal notes and temporary files

Committed files:
- All source code (`R/`, `inst/`)
- Documentation (`README.md`, `FUNCTION_REFERENCE.md`, `DEVELOPMENT.md`)
- Configuration (`.vscode/`, `DESCRIPTION`)
- Vignettes (`.qmd` files, not rendered output)
- Setup scripts

## Maintenance Guidelines

### Regular Cleanup Tasks

1. **Monthly**: Review `R/` for duplicate or outdated functions
2. **After major changes**: Update FUNCTION_REFERENCE.md
3. **Before commits**: Run `devtools::check()` to ensure package validity
4. **After adding data**: Document datasets in roxygen comments

### Documentation Sync

Keep these files synchronized:
- `DESCRIPTION` ↔ dependencies in `setup_environment.R`
- `R/*.R` roxygen comments ↔ `man/*.Rd` (auto-sync via `devtools::document()`)
- Function list in `FUNCTION_REFERENCE.md` ↔ actual `R/` files

## Version Control Strategy

### What to Commit

- ✅ Source code (`R/`, `inst/`)
- ✅ Documentation (`.md` files, vignettes)
- ✅ Configuration files
- ✅ Package metadata (DESCRIPTION)

### What NOT to Commit

- ❌ Build artifacts
- ❌ Auto-generated documentation (`docs/`, `man/`)
- ❌ IDE-specific files (except `.vscode/`)
- ❌ Large data files (consider separate data repository)
- ❌ Temporary analysis files

## References

- [R Packages Book](https://r-pkgs.org/) - Comprehensive guide to R package structure
- [tidyverse style guide](https://style.tidyverse.org/) - Coding style conventions
- [roxygen2 documentation](https://roxygen2.r-lib.org/) - Function documentation
