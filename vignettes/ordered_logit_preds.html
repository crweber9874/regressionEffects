<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Christopher Weber">
<meta name="dcterms.date" content="2025-10-07">

<title>Extending the Binary Model: Ordered Logit and Probit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ordered_logit_preds_files/libs/clipboard/clipboard.min.js"></script>
<script src="ordered_logit_preds_files/libs/quarto-html/quarto.js"></script>
<script src="ordered_logit_preds_files/libs/quarto-html/popper.min.js"></script>
<script src="ordered_logit_preds_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ordered_logit_preds_files/libs/quarto-html/anchor.min.js"></script>
<link href="ordered_logit_preds_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ordered_logit_preds_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ordered_logit_preds_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ordered_logit_preds_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ordered_logit_preds_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="ordered_logit_preds_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="ordered_logit_preds_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="ordered_logit_preds_files/libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="ordered_logit_preds_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="ordered_logit_preds_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="ordered_logit_preds_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="ordered_logit_preds_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<link href="ordered_logit_preds_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="ordered_logit_preds_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Extending the Binary Model: Ordered Logit and Probit</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Christopher Weber </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-ordered-logit" class="level2">
<h2 class="anchored" data-anchor-id="the-ordered-logit">The Ordered Logit</h2>
<p>This summary follows your assigned reading in Long (1997). One should only use an ordered parameterization when we have categorical data that are ordered – e.g., “like” versus “dislike.” Some data can be ordered, even if they are theoretically multidimensional; others should be modeled differently Examples of ordinal data are PID, Ideology (social and economic dimensions). Or “How much do you agree or disagree with the following item?” from “1” Strongly Disagree to “5” Strongly Agree.</p>
</section>
<section id="why-not-ols" class="level2">
<h2 class="anchored" data-anchor-id="why-not-ols">Why not OLS?</h2>
<p>Ordered, non-interval level data may violate the assumptions of the classical linear regression model. First, there is non-constant variance. Predictions may be non-sensical (i.e., we predict things outside of the observed bounds). And the category distances are theoretically not equally spaced.</p>
</section>
<section id="proportional-odds" class="level2">
<h2 class="anchored" data-anchor-id="proportional-odds">Proportional Odds</h2>
<ul>
<li><span class="math inline">\(y_{latent}\)</span>, where <span class="math inline">\(y_{obs} \in (1,2,3,...k)\)</span>.</li>
</ul>
<p>Instead of the variable being 0/1, it is not more than two categories that are ordered. Assume we knew <span class="math inline">\(y_{latent}\)</span> and would like to map that to observing a particular category. We’ll map the latent variable to the outcome, but now we’ll use multiple cut points, <span class="math inline">\(\tau\)</span> instead of one that is <span class="math inline">\(\tau = 0\)</span></p>
<p>Assume that we observe the category based on its orientation to a series of cutpoints, where</p>
<p><span class="math display">\[y_i=m: \tau_{k-1}\leq y_{latent} &lt; \tau_{k}\]</span></p>
</section>
<section id="the-measurement-model" class="level2">
<h2 class="anchored" data-anchor-id="the-measurement-model">The Measurement Model</h2>
<ul>
<li><p>The <span class="math inline">\(\tau\)</span> parameters represent a series of thresholds that map the latent variable onto the categorical variable.</p></li>
<li><p>In <span class="math inline">\(\texttt{MASS}::\texttt{polr}()\)</span> these are “zeta”</p></li>
<li><p>A (Long 1997, 123)</p></li>
</ul>
<p><span class="math display">\[y_{obs} =
  \begin{array}{lr}
    A, \tau_0=\infty \leq y_{latent}&lt;\tau_1\\
    B, \tau_1\leq y_{latent}&lt;\tau_2\\
    C, \tau_2\leq y_{latent}&lt;\tau_3\\
    D, \tau_3\leq y_{latent}&lt;\tau_4\\
    E, \tau_4\leq y_{latent}&lt;\tau_5=\infty
  \end{array}
\]</span></p>
</section>
<section id="the-structural-model" class="level2">
<h2 class="anchored" data-anchor-id="the-structural-model">The Structural Model</h2>
<p><span class="math display">\[y_{latent}=\beta_0 + \beta_1x_i +...\sum^{J}_{j =1} \beta_j x_{ij}+e_i\]</span></p>
<p><span class="math display">\[y=X\beta+e\]</span></p>
<p>Where each row vector of Xand any <span class="math inline">\(j+1\)</span> predictors. In the ordered logit or probit parameterization, we do not estimate the intercept, <span class="math inline">\(\beta_0\)</span>, because it is not uniquely identified from the cutpoints.</p>
<p>So what we’re doing is defining <span class="math inline">\(K-1\)</span> cutpoints, the slicing up the latent distribution into discrete categories.</p>
<p><span class="math display">\[\begin{eqnarray*}
pr(y_{i}=1|X_i) &amp; = &amp; pr(\tau_0 \leq y_{i,latent}&lt;\tau_1)|X_i) \\
             &amp; = &amp;  pr(\tau_0 \leq X_i b+e_i&lt;\tau_1)|X_i) \\
             &amp; = &amp;  pr(\tau_0 - X_ib \leq e_i&lt;\tau_1-X_ib)|X_i) \\
             &amp; = &amp;  pr(\tau_1-X_ib)|X_i)-pr(\tau_0 - X_ib|X_i) \\
             &amp; = &amp;  F(\tau_1-X_ib)-F(\tau_0 - X_ib) \\
\end{eqnarray*}\]</span></p>
<p>F denotes the CDF, then for the ordered probit:</p>
<p>The last row is simplified because the probability of the CDF evaluated from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span> is 1, so the first term becomes 1. Any CDF is plausible, such as the logit, in which case we have,</p>
<p><span class="math display">\[\begin{eqnarray*}
Pr(y_{i}=k|X_i) &amp; = &amp;\Phi(\tau_1-\alpha-\beta X) \\
             &amp; = &amp;  \Phi(\tau_2-\alpha-\beta X)-\Phi(\tau_1-\alpha-\beta X) \\
             &amp; = &amp;  \Phi(\tau_3-\alpha-\beta X)-\Phi(\tau_2-\alpha-\beta X)\\
             &amp; = &amp;  1-\Phi(\tau_4-\alpha-\beta X)\\
\end{eqnarray*}\]</span></p>
<p>Or if <strong>F</strong> is the logistic CDF, then we have the ordered logit:</p>
<p><span class="math display">\[\begin{eqnarray*}
Pr(y_{i}=k|X_i) &amp; = &amp;Logit(\tau_1-\alpha-\beta X) \\
                &amp; = &amp;  Logit(\tau_2-\alpha-\beta X)-Logit(\tau_1-\alpha-\beta X) \\
                &amp; = &amp;  Logit(\tau_3-\alpha-\beta X)-Logit(\tau_2-\alpha-\beta X)\\
             &amp; = &amp;  1-Logit(\tau_4-\alpha-\beta X)\\
\end{eqnarray*}\]</span></p>
<ul>
<li><span class="math inline">\(F\)</span> generically to mean the CDF; and <span class="math inline">\(f\)</span> to denote the PDF.</li>
</ul>
</section>
<section id="the-likelihood" class="level2">
<h2 class="anchored" data-anchor-id="the-likelihood">The Likelihood</h2>
<p>Recall, that the probability of being in the <span class="math inline">\(k\)</span>th category for the <span class="math inline">\(i\)</span>th subject is,</p>
<p><span class="math display">\[\begin{eqnarray*}
pr(y_{i}=k|X_i) &amp; = &amp; F(\tau_k-\alpha-X_i\beta)-F(\tau_{k-1}-\alpha-X_i\beta) \\
\end{eqnarray*}\]</span></p>
<p>And the likelihood of the ordered logit or probit model is the joint probability of being in each category, so we need to calculate the <strong>likelihood</strong> (<span class="math inline">\(L(y|\theta)\)</span>) as</p>
<p><span class="math display">\[Pr(y_{i}=1|X_i)\times pr(y_{i}=2|X_i) \times pr(y_{i}=3|X_i) \times....pr(y_{i}=K|X_i)\]</span>.</p>
<p>This is just the joint probability for category membership, for each subject, so</p>
<p><span class="math display">\[\begin{eqnarray*}
Pr(y_{i}|X_i) &amp; = &amp; \prod_{k=1}^K F(\tau_k-\alpha-X_i\beta)-F(\tau_{k-1}-\alpha-X_i\beta) \\
\end{eqnarray*}\]</span></p>
<p>This only refers to the probability space for a single subject. Since the likelihood is <span class="math inline">\(\prod_{i=1}^N p_i\)</span>, we need to calculate the joint probability for each subject, which is,</p>
<p><span class="math display">\[\begin{eqnarray*}
pr(y|X) &amp; = &amp; \prod_{i=1}^N \prod_{k=1}^K F(\tau_k-\alpha-X_i\beta)-F(\tau_{k-1}-\alpha-X_i\beta) \\
L(\beta \tau | y, X)&amp; = &amp; \prod_{i=1}^N \prod_{k=1}^K F(\tau_k-\alpha-X_i\beta)-F(\tau_{k-1}-\alpha-X_i\beta) \\
\end{eqnarray*}\]</span></p>
<p>Let’s again use the <strong>log likelihood</strong></p>
<p><span class="math display">\[\begin{eqnarray*}
Loglik(\beta \tau | y, X)&amp; = &amp; \sum_{i=1}^N \sum_{k=1}^K log[F(\tau_k-\alpha-X_i\beta)-F(\tau_{k-1}-\alpha-X_i\beta)] \\
\end{eqnarray*}\]</span></p>
<ul>
<li>Like the binary case: <span class="math inline">\(x \rightarrow y_{latent} \rightarrow y_{obs}\)</span>.</li>
</ul>
<p>The only thing that is different is that instead of a single cutpoint – at 0 – we have a series of cutpoints, corresponding to <strong>the number of categories minus 1</strong>.</p>
</section>
<section id="a-crucial-assumption-parallel-lines" class="level2">
<h2 class="anchored" data-anchor-id="a-crucial-assumption-parallel-lines">A Crucial Assumption: Parallel Lines</h2>
<p>The parallel lines assumption means that the effect of <span class="math inline">\(X\)</span> is the same across all categories.</p>
<div class="cell">
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-970aaad30924407230b2" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-970aaad30924407230b2">{"x":{"visdat":{"498c23c61e94":["function () ","plotlyVisDat"]},"cur_data":"498c23c61e94","attrs":{"498c23c61e94":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"scatter","mode":"lines","name":"Categories 2,3,4 versus Categories 1","inherit":true},"498c23c61e94.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"scatter","mode":"lines","name":"Categories 3,4 versus Categories 1,2","inherit":true},"498c23c61e94.2":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"type":"scatter","mode":"lines","name":"Category 4 versus Categories 1, 2, 3","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Parallel Lines","xaxis":{"domain":[0,1],"automargin":true,"title":"X-axis"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Y-axis"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-10,-9.7979797979797976,-9.5959595959595951,-9.3939393939393945,-9.191919191919192,-8.9898989898989896,-8.7878787878787872,-8.5858585858585865,-8.3838383838383841,-8.1818181818181817,-7.9797979797979792,-7.7777777777777777,-7.5757575757575761,-7.3737373737373737,-7.1717171717171713,-6.9696969696969697,-6.7676767676767682,-6.5656565656565657,-6.3636363636363633,-6.1616161616161618,-5.9595959595959593,-5.7575757575757578,-5.5555555555555554,-5.3535353535353538,-5.1515151515151514,-4.9494949494949498,-4.7474747474747474,-4.5454545454545459,-4.3434343434343434,-4.1414141414141419,-3.9393939393939394,-3.7373737373737379,-3.5353535353535355,-3.333333333333333,-3.1313131313131315,-2.9292929292929291,-2.7272727272727275,-2.5252525252525251,-2.3232323232323235,-2.1212121212121211,-1.9191919191919187,-1.717171717171718,-1.5151515151515156,-1.3131313131313131,-1.1111111111111107,-0.90909090909091006,-0.70707070707070763,-0.50505050505050519,-0.30303030303030276,-0.10101010101010033,0.10101010101010033,0.30303030303030276,0.50505050505050519,0.70707070707070763,0.90909090909090828,1.1111111111111107,1.3131313131313131,1.5151515151515156,1.7171717171717162,1.9191919191919187,2.1212121212121211,2.3232323232323235,2.5252525252525242,2.7272727272727266,2.9292929292929291,3.1313131313131315,3.3333333333333339,3.5353535353535346,3.737373737373737,3.9393939393939394,4.1414141414141419,4.3434343434343425,4.545454545454545,4.7474747474747474,4.9494949494949498,5.1515151515151505,5.3535353535353529,5.5555555555555554,5.7575757575757578,5.9595959595959584,6.1616161616161627,6.3636363636363633,6.565656565656564,6.7676767676767682,6.9696969696969688,7.171717171717173,7.3737373737373737,7.5757575757575744,7.7777777777777786,7.9797979797979792,8.1818181818181799,8.3838383838383841,8.5858585858585847,8.787878787878789,8.9898989898989896,9.1919191919191903,9.3939393939393945,9.5959595959595951,9.7979797979797993,10],"y":[0.00012339457598623172,0.00015101508515221734,0.00018481699660097167,0.0002261831242174684,0.00027680534191564633,0.00033875351792465749,0.0004145597543996538,0.00050732129563597168,0.00062082618979176249,0.00075970665671569991,0.0009296261533112874,0.0011375073648176831,0.0013918098129428744,0.0017028674854477161,0.0020832988757500926,0.0025485040812767627,0.0031172661270996932,0.0038124763968195603,0.0046620068384419277,0.005699754236697001,0.0069668839124894313,0.0085133010953921378,0.010399376944046072,0.012697951308046244,0.015496623724768321,0.018900324865165012,0.023034128681885445,0.028046215717659716,0.034110824206964062,0.041430921089968611,0.050240184162147719,0.060803707411619681,0.073416630912783026,0.08839967720705845,0.10609039614320445,0.12682886280844469,0.15093676035290007,0.1786893601788383,0.21028102179531874,0.24578651673774468,0.28512257494140081,0.3280160938691386,0.37398666873187658,0.42235060544315989,0.47225076494548685,0.52271163326063885,0.57271312061666191,0.62127171177032281,0.667515572897731,0.7107418823348397,0.75044932025243094,0.78634453633237078,0.81832653327149996,0.84645595535434559,0.87091698177216548,0.89197843865658066,0.90995874532806176,0.9251971950590383,0.93803233576844613,0.94878704852348061,0.95775929347237487,0.96521727323003037,0.97139780272451681,0.97650684659159426,0.98072140337342339,0.98419212870157624,0.9870462724693041,0.98939064973302637,0.99131447301382447,0.99289195026498278,0.99418460467693726,0.99524330598414024,0.99611002328723364,0.99681932072294288,0.99739962265992965,0.99787427665613715,0.99826244169307798,0.99857982721861327,0.99883930594064763,0.99905142053196805,0.99922480167688987,0.99936651234921592,0.99948233092373762,0.99957698371187842,0.99965433577209895,0.99971754735909768,0.99976920211756359,0.9998114120688274,0.9998459035551166,0.99987408757094653,0.99989711730166231,0.9999159351852247,0.99993131139762681,0.99994387532003681,0.99995414126430382,0.99996252950231868,0.99996938345506448,0.99997498374170146,0.99997955966163143,0.99998329857815205],"type":"scatter","mode":"lines","name":"Categories 2,3,4 versus Categories 1","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[-10,-9.7979797979797976,-9.5959595959595951,-9.3939393939393945,-9.191919191919192,-8.9898989898989896,-8.7878787878787872,-8.5858585858585865,-8.3838383838383841,-8.1818181818181817,-7.9797979797979792,-7.7777777777777777,-7.5757575757575761,-7.3737373737373737,-7.1717171717171713,-6.9696969696969697,-6.7676767676767682,-6.5656565656565657,-6.3636363636363633,-6.1616161616161618,-5.9595959595959593,-5.7575757575757578,-5.5555555555555554,-5.3535353535353538,-5.1515151515151514,-4.9494949494949498,-4.7474747474747474,-4.5454545454545459,-4.3434343434343434,-4.1414141414141419,-3.9393939393939394,-3.7373737373737379,-3.5353535353535355,-3.333333333333333,-3.1313131313131315,-2.9292929292929291,-2.7272727272727275,-2.5252525252525251,-2.3232323232323235,-2.1212121212121211,-1.9191919191919187,-1.717171717171718,-1.5151515151515156,-1.3131313131313131,-1.1111111111111107,-0.90909090909091006,-0.70707070707070763,-0.50505050505050519,-0.30303030303030276,-0.10101010101010033,0.10101010101010033,0.30303030303030276,0.50505050505050519,0.70707070707070763,0.90909090909090828,1.1111111111111107,1.3131313131313131,1.5151515151515156,1.7171717171717162,1.9191919191919187,2.1212121212121211,2.3232323232323235,2.5252525252525242,2.7272727272727266,2.9292929292929291,3.1313131313131315,3.3333333333333339,3.5353535353535346,3.737373737373737,3.9393939393939394,4.1414141414141419,4.3434343434343425,4.545454545454545,4.7474747474747474,4.9494949494949498,5.1515151515151505,5.3535353535353529,5.5555555555555554,5.7575757575757578,5.9595959595959584,6.1616161616161627,6.3636363636363633,6.565656565656564,6.7676767676767682,6.9696969696969688,7.171717171717173,7.3737373737373737,7.5757575757575744,7.7777777777777786,7.9797979797979792,8.1818181818181799,8.3838383838383841,8.5858585858585847,8.787878787878789,8.9898989898989896,9.1919191919191903,9.3939393939393945,9.5959595959595951,9.7979797979797993,10],"y":[0.00091105119440064539,0.0011147833441199496,0.0013640125215336391,0.0016688681177159336,0.0020417193684422754,0.0024976630175477898,0.0030551133692573265,0.0037365143339650763,0.0045691958590474528,0.0055863997907026151,0.006828502361184376,0.0083444615365500519,0.010193516460848633,0.012447161795007164,0.015191409838007068,0.018529335068062151,0.022583865261700569,0.027500735600776583,0.033451451055118181,0.040636001172127081,0.049284934325518837,0.059660223019174806,0.072054143618564021,0.086785173649676403,0.10418972279494806,0.12460843924642248,0.14836598933874684,0.17574374289308001,0.20694584934715762,0.24206081755024075,0.28102278025633637,0.32357870183457932,0.36926912882296675,0.41742979353768545,0.46721880785976294,0.51766940678843576,0.56776232353834344,0.61650680270111735,0.66301689495897198,0.70657097684341297,0.74664687466621982,0.78293082812505821,0.81530379900906558,0.84381191773073183,0.86862879046919328,0.89001644553267256,0.90828975065421802,0.92378700149102944,0.93684759571234577,0.9477964814295412,0.95693439151148441,0.96453262175983989,0.97083113028529056,0.97603889875903294,0.98033571260902796,0.98387473215452137,0.98678541307709944,0.98917648321794316,0.99113879409567307,0.9927479449724177,0.99406663137424311,0.99514670505046499,0.99603095381574691,0.99675462178723284,0.9973466963609805,0.99783099013049426,0.99822704540520779,0.99855088709473039,0.99881564717414228,0.99903208116946851,0.99920899436004507,0.99935359283064562,0.99947177219203265,0.99956835474925843,0.99964728413056281,0.99971178487883849,0.99976449322775529,0.9998075642083728,0.99984275933223121,0.99987151834795962,0.99989501794731028,0.9999142197828611,0.99992990973582507,0.99994273002335099,0.99995320544768507,0.99996176485379396,0.9999687586686028,0.99997447323638955,0.9999791425349005,0.99998295775032675,0.99998607510213466,0.99998862223745688,0.99999070345639673,0.99999240398191336,0.99999379344891082,0.99999492875527785,0.99999585639152544,0.9999966143443636,0.9999972336521249,0.99999773967570205],"type":"scatter","mode":"lines","name":"Categories 3,4 versus Categories 1,2","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[-10,-9.7979797979797976,-9.5959595959595951,-9.3939393939393945,-9.191919191919192,-8.9898989898989896,-8.7878787878787872,-8.5858585858585865,-8.3838383838383841,-8.1818181818181817,-7.9797979797979792,-7.7777777777777777,-7.5757575757575761,-7.3737373737373737,-7.1717171717171713,-6.9696969696969697,-6.7676767676767682,-6.5656565656565657,-6.3636363636363633,-6.1616161616161618,-5.9595959595959593,-5.7575757575757578,-5.5555555555555554,-5.3535353535353538,-5.1515151515151514,-4.9494949494949498,-4.7474747474747474,-4.5454545454545459,-4.3434343434343434,-4.1414141414141419,-3.9393939393939394,-3.7373737373737379,-3.5353535353535355,-3.333333333333333,-3.1313131313131315,-2.9292929292929291,-2.7272727272727275,-2.5252525252525251,-2.3232323232323235,-2.1212121212121211,-1.9191919191919187,-1.717171717171718,-1.5151515151515156,-1.3131313131313131,-1.1111111111111107,-0.90909090909091006,-0.70707070707070763,-0.50505050505050519,-0.30303030303030276,-0.10101010101010033,0.10101010101010033,0.30303030303030276,0.50505050505050519,0.70707070707070763,0.90909090909090828,1.1111111111111107,1.3131313131313131,1.5151515151515156,1.7171717171717162,1.9191919191919187,2.1212121212121211,2.3232323232323235,2.5252525252525242,2.7272727272727266,2.9292929292929291,3.1313131313131315,3.3333333333333339,3.5353535353535346,3.737373737373737,3.9393939393939394,4.1414141414141419,4.3434343434343425,4.545454545454545,4.7474747474747474,4.9494949494949498,5.1515151515151505,5.3535353535353529,5.5555555555555554,5.7575757575757578,5.9595959595959584,6.1616161616161627,6.3636363636363633,6.565656565656564,6.7676767676767682,6.9696969696969688,7.171717171717173,7.3737373737373737,7.5757575757575744,7.7777777777777786,7.9797979797979792,8.1818181818181799,8.3838383838383841,8.5858585858585847,8.787878787878789,8.9898989898989896,9.1919191919191903,9.3939393939393945,9.5959595959595951,9.7979797979797993,10],"y":[0.0066928509242848554,0.0081789428562821613,0.0099916899362080588,0.012201264260636075,0.014892116363260341,0.018165492507155691,0.022142203958132146,0.026965570368090212,0.032804390909942818,0.039855698945889695,0.048346922719897809,0.058536902874367899,0.070715012027143642,0.085197401061588379,0.10231920350807022,0.12242143898621305,0.14583148353491501,0.17283646446618905,0.2036499335022193,0.23837374421039675,0.27695909778815886,0.31917282672147035,0.36457644074163931,0.41252537040181819,0.46219351092684902,0.51262357943007497,0.56279795369438246,0.61171941140716124,0.65848848940252069,0.70236511502557752,0.74280634723561778,0.7794778729544305,0.81224231094517951,0.8411308951190849,0.86630626410614642,0.88802329038025296,0.90659299528316784,0.92235245391657517,0.9356417590466013,0.94678782922608895,0.95609411885006113,0.96383499877981238,0.97025357461592576,0.97556186338166717,0.97994246346214953,0.98355106930658209,0.98651937229915421,0.98895804166250523,0.99095959419106694,0.99260104395028037,0.99394627939345837,0.99504815206560837,0.99595028367562977,0.99668861116732732,0.9972926957603816,0.99778682410771702,0.99819092935635756,0.99852135810545573,0.99879150674754447,0.99901234791145366,0.99919286497151605,0.9993404100018195,0.99946099821337242,0.99955954984498185,0.99964008868547005,0.99970590486945987,0.99975968828718109,0.99980363785338222,0.99983955096412114,0.99986889670726231,0.99989287575955066,0.99991246937955591,0.99992847947371377,0.9999415613567707,0.99995225053522985,0.99996098460193872,0.99996812113264033,0.99997395231349717,0.99997871689603068,0.99998260996730992,0.9999857909343467,0.99998839004889428,0.99999051373933501,0.99999224896766326,0.99999366678975676,0.99999482526457883,0.99999577183134991,0.99999654525196324,0.99999717719814474,0.99999769354832591,0.99999811544731265,0.9999984601721349,0.99999874183952464,0.99999897198398868,0.99999916003014266,0.99999931367864969,0.99999943922156442,0.99999954179999417,0.99999962561463129,0.99999969409777301],"type":"scatter","mode":"lines","name":"Category 4 versus Categories 1, 2, 3","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Each line corresponds to a log odds of combining categories into a <strong>cumulative log odds</strong> where the lines are parallel, <em>or the odds ratios are constant, they are proportional</em>. The distance between the lines is constant, which means that the effect of <span class="math inline">\(X\)</span> is the same across all categories.</p>
</section>
<section id="estimation" class="level2">
<h2 class="anchored" data-anchor-id="estimation">Estimation</h2>
<p>Let’s estimate an ordered logit model in <code>R</code>, from the <code>MASS</code> package. Data are collected <strong>pre</strong> or <strong>post</strong> election, and we want to see if support for electoral contestation behavior (here, attending a march) changes in support over this period – for Trump voters versus Biden voters. This is specified to examine whether support for contestation varies depending upon electoral functions; a <strong>winner-loser effect</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://raw.githubusercontent.com/crweber9874/advancedRegression/main/data/wss20.rda"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> <span class="st">"wss20.rda"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Load into session</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"wss20.rda"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>wss20 <span class="ot">=</span> wss20 <span class="sc">|&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> contestation,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> contestation_value</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>sample_df <span class="ot">&lt;-</span> wss20 <span class="sc">|&gt;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contestation =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(attend_march, criticize_election, burn_flag, court, recount), <span class="at">na.rm =</span> </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span>), <span class="co"># Construct a continuous scale</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">vote_trump =</span> presvote_trump_2020,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">authoritarianism =</span> <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(auth_1, auth_2, auth_3, auth_4), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">republican =</span> <span class="fu">ifelse</span>(party_identification3 <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">democrat =</span> <span class="fu">ifelse</span>(party_identification3 <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">independent =</span> <span class="fu">ifelse</span>(party_identification3 <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">libcon =</span> (ideology5 <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">prepost =</span> <span class="fu">ifelse</span>(prepost <span class="sc">==</span> <span class="st">"post"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>my_model <span class="ot">=</span> <span class="fu">polr</span>(<span class="fu">as.factor</span>(attend_march) <span class="sc">~</span> prepost<span class="sc">*</span>vote_trump , </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> sample_df)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>my_model <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
polr(formula = as.factor(attend_march) ~ prepost * vote_trump, 
    data = sample_df)

Coefficients:
                     Value Std. Error t value
prepost            -0.2734    0.09635  -2.837
vote_trump         -1.8204    0.08311 -21.904
prepost:vote_trump  0.9590    0.16672   5.752

Intercepts:
    Value    Std. Error t value 
1|2  -2.2704   0.0695   -32.6655
2|3  -1.2953   0.0598   -21.6506
3|4  -0.1200   0.0538    -2.2319
4|5   1.2149   0.0610    19.9185

Residual Deviance: 8636.318 
AIC: 8650.318 
(719 observations deleted due to missingness)</code></pre>
</div>
</div>
<p>There is clearly an interaction effect – support varies depending on whether the observation was before or after the election <strong>and</strong> whether the respondent voted for Trump or Biden. The sign of the lower order and interaction terms seems to indicate that Trump supporters are more supportive, post-election; Biden voters are more supporting in the pre-election. But how should we interpret this.</p>
<p>In the <code>regressionEffects</code> package, there are functions to generate predicted probabilities from an ordered logit or probit model. We can use these to generate predicted probabilities for each category, across levels of <code>prepost</code> and <code>vote_trump</code>. If you first install the <code>devtools</code> package, you can install <code>regressionEffects</code> from GitHub:</p>
<p>Instead of loading the entire package into your workspace with <code>devtools::</code>, this allows one to estimate a function from within the package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("crweber9874/regressionEffects")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s nothing terribly complex about the functions in the package. They basically just provide a workflow that includes wrappers for using other packages, like <code>MASS</code>, <code>dplyr</code>, and <code>ggplot2</code>.</p>
<p>First, create a <strong>design</strong> matrix corresponding to the things (from the model) that you’d like to predict. Here, let’s predict the probability of attending a march, across levels of <code>prepost</code> and <code>vote_trump</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(regressionEffects)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>design_matrix <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">prepost =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">vote_trump =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict_ordinal_probs</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">design_matrix =</span> design_matrix,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> my_model,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_draws =</span> <span class="dv">1000</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The dimensions of this matrix:</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dim</span>(predictions)[<span class="dv">1</span>], <span class="st">"rows and"</span>, </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dim</span>(predictions)[<span class="dv">2</span>], <span class="st">"columns."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The dimensions of this matrix:
 20000 rows and 5 columns.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   draw prepost vote_trump category probability
  &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
1     1       0          0 1             0.0925
2     1       0          0 2             0.134 
3     1       0          0 3             0.256 
4     1       0          0 4             0.292 
5     1       0          0 5             0.225 
6     2       0          0 1             0.0913</code></pre>
</div>
</div>
<p>Let’s now create summaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_predictions</span>(predictions) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  prepost vote_trump category mean_prob median_prob sd_prob lower_ci upper_ci
    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1       0          0 1           0.0935      0.0934 0.00575   0.0821    0.105
2       0          0 2           0.121       0.121  0.00624   0.109     0.133
3       0          0 3           0.255       0.255  0.00880   0.238     0.271
4       0          0 4           0.302       0.301  0.0102    0.282     0.321
5       0          0 5           0.229       0.229  0.0106    0.209     0.251
6       0          1 1           0.389       0.389  0.0152    0.359     0.420</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_predictions</span>(predictions) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepost_label =</span> <span class="fu">factor</span>(prepost, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pre-Election"</span>, <span class="st">"Post-Election"</span>)),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">vote_trump_label =</span> <span class="fu">factor</span>(vote_trump,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Biden Voters"</span>, <span class="st">"Trump Voters"</span>)),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">factor</span>(category)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prepost_label, <span class="at">y =</span> mean_prob, <span class="at">color =</span> category, <span class="at">group =</span> category)) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">0.8</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linewidth =</span> <span class="dv">1</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>vote_trump_label, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Response</span><span class="sc">\n</span><span class="st">Category"</span>,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted Probabilities by Election Period and Vote Choice"</span>,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Points show mean probability with 95% confidence intervals"</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"lightgrey"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"grey"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"darkgrey"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"darkslategrey"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"black"</span>),</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a> <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Strongly Not Support"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Do Not Support"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Neutral"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Support"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"Strongly Support"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ordered_logit_preds_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is useful but sort of messy, because we don’t know how many observations are in each of the cells. All we can see is that support for attending a march increases after the election (for Trump voters), but the opposite occurs for Biden voters. Let’s scale the points by the number of observations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyr)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Construct the scale for observed_counts</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># observed_counts &lt;- sample_df %&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(prepost, vote_trump, attend_march) |&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(n = n(), .groups = "drop") |&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(category = attend_march) %&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(category = factor(category)) |&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(vote_trump)) </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Filter Biden Voter</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_dat = summarize_predictions(predictions) |&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     category = factor(category)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(observed_counts, by = c("prepost", "vote_trump", "category")) %&gt;%</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     prepost_label = factor(prepost, </span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                           levels = c(0, 1), </span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                           labels = c("Pre-Election", "Post-Election")),</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     vote_trump_label = factor(vote_trump,</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                              levels = c(0, 1),</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                              labels = c("Biden Voters", "Trump Voters")),</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_scaled = n / sum(n) </span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt;</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(vote_trump ==0)</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plotSunflower(plot_dat,</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#               sunflower_data = observed_counts)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::load_all()</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Data preparation (done once, outside the function)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># observed_counts &lt;- sample_df |&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(prepost, attend_march) %&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(n = n(), .groups = "drop") %&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(category = attend_march) %&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(category = factor(category)) %&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(vote_trump)) |&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(vote_trump == 0)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_summary &lt;- summarize_predictions(predictions) %&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(category = factor(category))</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_data &lt;- sample_df %&gt;%</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(vote_trump)) %&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(category = factor(attend_march)) %&gt;%</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(pred_summary %&gt;% </span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co">#               dplyr::select(prepost, vote_trump, category, mean_prob), </span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co">#             by = c("prepost", "vote_trump", "category")) %&gt;%</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     prepost_label = factor(prepost, levels = c(0, 1), </span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                           labels = c("Pre-Election", "Post-Election")),</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     vote_trump_label = factor(vote_trump, levels = c(0, 1),</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                              labels = c("Biden Voters", "Trump Voters"))</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_summary &lt;- pred_summary %&gt;%</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(observed_counts, by = c("prepost", "vote_trump", "category")) %&gt;%</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     prepost_label = factor(prepost, levels = c(0, 1), </span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="co">#                           labels = c("Pre-Election", "Post-Election")),</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     vote_trump_label = factor(vote_trump, levels = c(0, 1),</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co">#                              labels = c("Biden Voters", "Trump Voters"))</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co"># # Then create the plot</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_predictions(plot_data |&gt; filter(vote_trump == 0), pred_summary)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vayr)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>observed_counts <span class="ot">&lt;-</span> sample_df <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(prepost, vote_trump, attend_march) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> attend_march) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(category)) <span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vote_trump))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions for joining</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>pred_summary <span class="ot">&lt;-</span> <span class="fu">summarize_predictions</span>(predictions) <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(category))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> sample_df <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vote_trump)) <span class="sc">%&gt;%</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(attend_march)) <span class="sc">%&gt;%</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pred_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(prepost, vote_trump, category, mean_prob), </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"prepost"</span> <span class="ot">=</span> <span class="st">"prepost"</span>, <span class="st">"vote_trump"</span> <span class="ot">=</span> <span class="st">"vote_trump"</span>, <span class="st">"category"</span> <span class="ot">=</span> <span class="st">"category"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepost_label =</span> <span class="fu">factor</span>(prepost, </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pre-Election"</span>, <span class="st">"Post-Election"</span>)),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">vote_trump_label =</span> <span class="fu">factor</span>(vote_trump,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Biden Voters"</span>, <span class="st">"Trump Voters"</span>))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>pred_summary <span class="sc">%&gt;%</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(observed_counts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"prepost"</span>, <span class="st">"vote_trump"</span>, <span class="st">"category"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepost_label =</span> <span class="fu">factor</span>(prepost, </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pre-Election"</span>, <span class="st">"Post-Election"</span>)),</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">vote_trump_label =</span> <span class="fu">factor</span>(vote_trump,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Biden Voters"</span>, <span class="st">"Trump Voters"</span>))</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prepost_label, <span class="at">y =</span> mean_prob, <span class="at">color =</span> category, <span class="at">group =</span> category)) <span class="sc">+</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sunflowers centered at predicted probabilities</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> plot_data, </span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> prepost_label, <span class="at">y =</span> mean_prob, <span class="at">color =</span> category),</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_sunflowerdodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">density =</span> <span class="dv">50</span>, <span class="at">aspect_ratio =</span> <span class="dv">5</span>),</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci),</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci, <span class="at">fill =</span> category),</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span>)  <span class="sc">+</span> </span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>vote_trump_label, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Probability"</span>,</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Response</span><span class="sc">\n</span><span class="st">Category"</span>,</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted Probabilities by Election Period and Vote Choice"</span>,</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">" Lines show change in predicted probabilities;</span><span class="sc">\n</span><span class="st">Sunflower plot corresponds to the relative proportion of respondents in that category;</span><span class="sc">\n</span><span class="st">error bars are 95% confidence intervals"</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"lightgrey"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"grey"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"darkgrey"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"darkslategrey"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"black"</span>),</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a> <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Strongly Not Support"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Do Not Support"</span>, <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Neutral"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Support"</span>, <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"Strongly Support"</span>)) <span class="ot">-&gt;</span> points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_errorbar(aes(ymin = lower_ci, ymax = upper_ci, fill =
category), : Ignoring unknown aesthetics: fill</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>points</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ordered_logit_preds_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vayr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>observed_counts <span class="ot">&lt;-</span> sample_df <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(prepost, vote_trump, attend_march) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">category =</span> attend_march) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(category)) <span class="sc">|&gt;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vote_trump))</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>pred_summary <span class="ot">&lt;-</span> <span class="fu">summarize_predictions</span>(predictions) <span class="sc">%&gt;%</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(category))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>expected_values_ci <span class="ot">&lt;-</span> predictions <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category_num =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(category))) <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(draw, prepost, vote_trump) <span class="sc">%&gt;%</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">expected_value =</span> <span class="fu">sum</span>(category_num <span class="sc">*</span> probability), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(prepost, vote_trump) <span class="sc">%&gt;%</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_expected =</span> <span class="fu">mean</span>(expected_value),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower_ci =</span> <span class="fu">quantile</span>(expected_value, <span class="fl">0.025</span>),</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper_ci =</span> <span class="fu">quantile</span>(expected_value, <span class="fl">0.975</span>),</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepost_label =</span> <span class="fu">factor</span>(prepost, </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pre-Election"</span>, <span class="st">"Post-Election"</span>)),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">vote_trump_label =</span> <span class="fu">factor</span>(vote_trump,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Biden Voters"</span>, <span class="st">"Trump Voters"</span>))</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co"># View expected values with CI</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expected_values_ci)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  prepost vote_trump mean_expected lower_ci upper_ci prepost_label
    &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;        
1       0          0          3.45     3.39     3.52 Pre-Election 
2       0          1          2.18     2.11     2.26 Pre-Election 
3       1          0          3.26     3.15     3.37 Post-Election
4       1          1          2.65     2.49     2.82 Post-Election
# ℹ 1 more variable: vote_trump_label &lt;fct&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare raw data aligned with predicted probabilities</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> sample_df <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(vote_trump)) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">factor</span>(attend_march)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pred_summary <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(prepost, vote_trump, category, mean_prob), </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"prepost"</span> <span class="ot">=</span> <span class="st">"prepost"</span>, <span class="st">"vote_trump"</span> <span class="ot">=</span> <span class="st">"vote_trump"</span>, <span class="st">"category"</span> <span class="ot">=</span> <span class="st">"category"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">prepost_label =</span> <span class="fu">factor</span>(prepost, </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pre-Election"</span>, <span class="st">"Post-Election"</span>)),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">vote_trump_label =</span> <span class="fu">factor</span>(vote_trump,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Biden Voters"</span>, <span class="st">"Trump Voters"</span>))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected value plot WITH confidence intervals</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected value plot with 1-5 scale and labeled points</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(expected_values_ci, <span class="fu">aes</span>(<span class="at">x =</span> prepost_label, <span class="at">y =</span> mean_expected, </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                               <span class="at">color =</span> vote_trump_label, <span class="at">group =</span> vote_trump_label)) <span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add midpoint reference line at 3</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">3</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = vote_trump_label),</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#             alpha = 0.2, color = NA) +</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_ci, <span class="at">ymax =</span> upper_ci),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.005</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Expected Support Level"</span>,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Vote Choice"</span>,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Vote Choice"</span>,</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Attend a March or Rally"</span>,</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Expected value = sum(category x probability) with 95% confidence intervals"</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Oppose"</span>, </span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>               <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Neutral"</span>, </span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>               <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Support"</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Biden Voters"</span> <span class="ot">=</span> <span class="st">"#457B9D"</span>, <span class="st">"Trump Voters"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>)) <span class="sc">+</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Biden Voters"</span>  <span class="ot">=</span> <span class="st">"#457B9D"</span>, <span class="st">"Trump Voters"</span> <span class="ot">=</span> <span class="st">"#E63946"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Ignoring unknown labels:
• fill : "Vote Choice"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: No shared levels found between `names(values)` of the manual scale and the
data's fill values.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ordered_logit_preds_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="marginal-effects." class="level2">
<h2 class="anchored" data-anchor-id="marginal-effects.">Marginal effects.</h2>
<p>Say are interest is in whether these changes are statistically significant at the conventional 0.05 level. We can use the <code>predict_logit_probs()</code> function to generate predicted probabilities from a binary logit model, and then summarize those predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>me <span class="ot">=</span> <span class="fu">calculate_marginal_effect</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  predictions,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">focal_var =</span> <span class="st">"prepost"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">focal_contrast =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">moderator =</span> <span class="st">"vote_trump"</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(me)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
   vote_trump category mean_effect median_effect sd_effect lower_ci upper_ci
        &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1          0 1             0.0260        0.0255   0.00963  0.00857  0.0459 
 2          0 2             0.0237        0.0233   0.00837  0.00799  0.0404 
 3          0 3             0.0183        0.0181   0.00599  0.00628  0.0296 
 4          0 4            -0.0236       -0.0233   0.00884 -0.0413  -0.00727
 5          0 5            -0.0443       -0.0437   0.0150  -0.0734  -0.0151 
 6          1 1            -0.145        -0.146    0.0263  -0.196   -0.0912 
 7          1 2            -0.0224       -0.0218   0.00773 -0.0392  -0.00923
 8          1 3             0.0558        0.0563   0.00913  0.0369   0.0723 
 9          1 4             0.0705        0.0703   0.0151   0.0410   0.101  
10          1 5             0.0415        0.0410   0.0101   0.0232   0.0625 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Plotting the marginal effects</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(me <span class="sc">|&gt;</span> <span class="fu">filter</span>(vote_trump <span class="sc">==</span> <span class="dv">0</span>), <span class="fu">aes</span>(<span class="at">y =</span> category, <span class="at">x =</span> mean_effect)) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower_ci, <span class="at">xmax =</span> upper_ci), </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">height =</span> <span class="fl">0.05</span>, </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">"darkgrey"</span>) <span class="sc">+</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"darkgrey"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Estimated Effect and Confidence Interval"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Category"</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Marginal Effects (Biden Voters)"</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="at">by =</span> <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Strongly Not Support"</span>, </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Do Not Support"</span>, </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>      <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Neutral"</span>, </span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>      <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Support"</span>, </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"Strongly Support"</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `geom_errobarh()` was deprecated in ggplot2 4.0.0.
ℹ Please use the `orientation` argument of `geom_errorbar()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the plot</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`height` was translated to `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ordered_logit_preds_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This gives us the marginal effect of supporting attending a march, for Trump voters versus Biden voters, from pre- to post-election. The marginal effect is just the change from pre to post for each group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'patchwork'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:MASS':

    area</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>  points <span class="sc">+</span> p <span class="sc">+</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`height` was translated to `width`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ordered_logit_preds_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>